<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="./assets/favicon.jpg">
  <title>ğŸ MY ROUTINES</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: var(--bs-body-bg);
    }

    .routine-card {
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .routine-card:hover {
      transform: scale(1.03);
    }

    #timerView {
      display: none;
    }

    .timer-number {
      font-size: 4rem;
      font-weight: bold;
    }

    .task-current {
      background-color: #d1e7dd;
      font-weight: 600;
    }

    .task-complete {
      opacity: 0.5;
      text-decoration: line-through;
    }

    #scheduleTableBody tr {
      transition: background-color 0.4s ease, opacity 0.4s ease;
    }
  </style>
</head>

<body>
<div class="container py-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 
        class="mb-0"
        style="cursor: pointer"
        onclick="resetToHome()">
        ğŸ MY ROUTINES
    </h2>
    <button class="btn btn-outline-secondary" onclick="toggleTheme()">ğŸŒ™</button>
  </div>

  <!-- test -->
 <div
    class="modal fade"
    id="imageModal"
    tabindex="-1"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0">
        <div class="modal-body text-center">
          <img
            id="modalImage"
            class="img-fluid rounded shadow"
            alt="Random"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- ROUTINE GRID -->
  <div id="routineGrid" class="container">
    <div class="row g-4">
      <div>Day & Night</div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('morning')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸŒ… Morning Routine</h5>
            <p class="text-muted small" id="morningMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('workMorning')">
          <div class="card-body text-center">
            <h5 class="card-title"> â˜€ï¸ Morning Routine (work)</h5>
            <p class="text-muted small" id="workMorningMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('night')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸŒ™ Night Routine</h5>
            <p class="text-muted small" id="nightMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('nightShower')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸŒš Night Routine (shower)</h5>
            <p class="text-muted small" id="nightShowerMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('everythingShower')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ§¼ Everything Shower</h5>
            <p class="text-muted small" id="everythingShowerMeta"></p>
          </div>
        </div>
      </div>
      <hr>

      <div>Exercise</div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('middayStretch')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ§â€â™‚ï¸ Midday Stretch</h5>
            <p class="text-muted small" id="middayStretchMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('cardioExercise')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ«€ Cardio Exercise (Mon/Thur)</h5>
            <p class="text-muted small" id="cardioExerciseMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('upperBodyExercise')">
          <div class="card-body text-center">
            <h5 class="card-title"> âœŒï¸ Upper Body Exercise (Tues/Fri)</h5>
            <p class="text-muted small" id="upperBodyExerciseMeta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('lowerBodyExercise')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸƒâ€â™€ï¸â€â¡ï¸ Lower Body Exercise (Weds/Sat)</h5>
            <p class="text-muted small" id="lowerBodyExerciseMeta"></p>
          </div>
        </div>
      </div>
      <hr>

      <div>Music <i>- Have metronome ready</i></div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('piano15')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¹ Piano [15 min]</h5>
            <p class="text-muted small" id="piano15Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('piano30')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¹ Piano [30 min]</h5>
            <p class="text-muted small" id="piano30Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('piano45')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¹ Piano [45 min]</h5>
            <p class="text-muted small" id="piano45Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('piano60')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¹ Piano [1 Hr]</h5>
            <p class="text-muted small" id="piano60Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('musicTheory15')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸµ Music Theory [15 min]</h5>
            <p class="text-muted small" id="musicTheory15Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('musicTheory30')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸµ Music Theory [30 min]</h5>
            <p class="text-muted small" id="musicTheory30Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('musicTheory45')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸµ Music Theory [45 min]</h5>
            <p class="text-muted small" id="musicTheory45Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('musicTheory60')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸµ Music Theory [1 Hr]</h5>
            <p class="text-muted small" id="musicTheory60Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('guitar15')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¸ Guitar [15 min]</h5>
            <p class="text-muted small" id="guitar15Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('guitar30')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¸ Guitar [30 min]</h5>
            <p class="text-muted small" id="guitar30Meta"></p>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('guitar45')">
          <div class="card-body text-center">
            <h5 class="card-title"> ğŸ¸ Guitar [45 min]</h5>
            <p class="text-muted small" id="guitar45Meta"></p>
          </div>
        </div>
      </div>
      <hr>

      <div>Art & Animation <i>- Have references ready [faces, postures, hands, art]</i></div>
      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('drawing15')">
          <div class="card-body text-center">
            <h5 class="card-title"> âœï¸ drawing [15 min]</h5>
            <p class="text-muted small" id="drawing15Meta"></p>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('drawing30')">
          <div class="card-body text-center">
            <h5 class="card-title"> âœï¸ drawing [30 min]</h5>
            <p class="text-muted small" id="drawing30Meta"></p>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('drawing45')">
          <div class="card-body text-center">
            <h5 class="card-title"> âœï¸ drawing [45 min]</h5>
            <p class="text-muted small" id="drawing45Meta"></p>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="card routine-card" onclick="startRoutine('drawing60')">
          <div class="card-body text-center">
            <h5 class="card-title"> âœï¸ drawing [1 Hr]</h5>
            <p class="text-muted small" id="drawing60Meta"></p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- TIMER VIEW -->
  <div id="timerView" class="text-center">

    <p id="routineTitle"></p>
    <h1 id="taskName" class="mb-3"></h1>

    <div class="timer-number mb-3" id="timeLeft">00:00</div>

    <div class="mb-3">
        <button class="btn btn-danger me-2" onclick="pauseTimer()">Stop</button>
        <button class="btn btn-primary me-2" onclick="resumeTimer()">Go</button>
        <button class="btn btn-outline-primary" onclick="skipTask()">â­ï¸</button>
    </div>

    <p class="text-muted">
      Task <span id="taskIndex"></span> of <span id="taskTotal"></span>
    </p>

    <!-- MOBILE COLLAPSIBLE SCHEDULE -->
    <button class="btn btn-outline-secondary w-100 d-md-none mb-3"
      data-bs-toggle="collapse"
      data-bs-target="#scheduleCollapse">
      Toggle Schedule
    </button>

    <div class="collapse d-md-block" id="scheduleCollapse">
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Task</th>
            <th>Duration</th>
            <th>Done By</th>
          </tr>
        </thead>
        <tbody id="scheduleTableBody"></tbody>
      </table>
    </div>

  </div>
</div>

<!-- SOUNDS -->
<audio id="beep" src="./assets/click.mp3"></audio>
<audio id="done" src="./assets/final.mp3"></audio>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= DATA ================= */

const routines = {
  morning: {
    title: "ğŸŒ… Morning Routine",
    tasks: [
      { name: "5 min of extra sleep...", minutes: 5 },
      { name: "in bed wake up...", minutes: 10 },
      { name: "Ok, GET UP & stretch [ice and boil water]", minutes: 15},
      { name: "sit & enjoy tea & get sunlight", minutes: 20},
      { name: "do puzzle, math, or music theory. more silence pls", minutes: 10},
      { name: "eat at the piano/guitar or draw & eat", minutes: 30},
    ]
  },
  workMorning: {
    title: "â˜€ï¸ Morning Routine (work)",
    tasks: [
      { name: "5 min of extra sleep...", minutes: 5 },
      { name: "in bed wake up...", minutes: 5 },
      { name: "Ok, GET UP & stretch [ice and boil water]", minutes: 10 },
      { name: "Clean Teeth & cover hair", minutes: 5 },
      { name: "Shower", minutes: 10 },
      { name: "Dry up, lotion, skin care", minutes: 10 },
      { name: "Put on Clothes", minutes: 5 },
      { name: "Do hair style", minutes: 6 },
      { name: "Pack Bag, lunch, water. Rest up, drink tea", minutes: 15 },
      { name: "Go down to car & start it", minutes: 67 },
    ]
  },
  night: {
    title: "ğŸŒ™ Night Routine",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  nightShower: {
    title: "ğŸŒš Night Routine (shower)",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  everythingShower: {
    title: "ğŸ§¼ Everything Shower",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  middayStretch: {
    title: "ğŸ§â€â™‚ï¸ Midday Stretch",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  cardioExercise: {
    title: "ğŸ«€ Cardio Exercise (Mon/Thur)",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  upperBodyExercise: {
    title: "âœŒï¸ Upper Body Exercise (Tues/Fri)",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  lowerBodyExercise: {
    title: "ğŸƒâ€â™€ï¸â€â¡ï¸ Lower Body Exercise (Weds/Sat)",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  piano15: {
    title: "ğŸ¹ Piano [15 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  piano30: {
    title: "ğŸ¹ Piano [30 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  piano45: {
    title: "ğŸ¹ Piano [45 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  piano60: {
    title: "ğŸ¹ Piano [1 Hr]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  musicTheory15: {
    title: "ğŸµ Music Theory [15 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  musicTheory30: {
    title: "ğŸµ Music Theory [30 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  musicTheory45: {
    title: "ğŸµ Music Theory [45 min]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  musicTheory60: {
    title: "ğŸµ Music Theory [1 Hr]",
    tasks: [
      { name: "Wind Down", minutes: 10 },
      { name: "Skincare", minutes: 10 },
      { name: "Read", minutes: 20 }
    ]
  },
  guitar15: {
    title: "ğŸ¸ Guitar [15 min]",
    tasks: [
      { name: "Warm Up : Scales + Spider 1-2-3-4 or 1-3-2-4", minutes: 5 },
      { name: "Fretboard Practice", minutes: 5 },
      { name: "Chord Shapes & Chord Transitions", minutes: 5 }
    ]
  },
  guitar30: {
    title: "ğŸ¸ Guitar [30 min]",
    tasks: [
      { name: "Warm Up : Scales + Spider 1-2-3-4 or 1-3-2-4", minutes: 5 },
      { name: "Fretboard Practice", minutes: 10 },
      { name: "Chord Shapes & Chord Transitions", minutes: 5 },
      { name: "Strumming Pattern", minutes: 5 },
      { name: "Play a solo", minutes: 5 },
    ]
  },
  guitar45: {
    title: "ğŸ¸ Guitar [45 min]",
    tasks: [
      { name: "Warm Up : Scales + Spider 1-2-3-4 or 1-3-2-4", minutes: 5 },
      { name: "Fretboard Practice", minutes: 10 },
      { name: "Chord Shapes & Chord Transitions & Power Chords", minutes: 10 },
      { name: "Strumming Pattern", minutes: 5 },
      { name: "Play a solo", minutes: 15 },
    ]
  },
  drawing15: {
    title: "âœï¸ drawing [15 min]",
    tasks: [
      { name: "Warm Ups", minutes: 5 },
      { name: "Caricature - Face 1", minutes: 2.5 },
      { name: "Caricature - Face 2", minutes: 2.5 },
      { name: "Body Poses Study", minutes: 5}
    ]
  },
  drawing30: {
    title: "âœï¸ drawing [30 min]",
    tasks: [
      { name: "Warm Ups", minutes: 5 },
      { name: "Caricature - Face 1", minutes: 2.5 },
      { name: "Caricature - Face 2", minutes: 2.5 },
      { name: "Body Poses Study", minutes: 10 },
      { name: "Face Study", minutes: 10 },
    ]
  },
  drawing45: {
    title: "âœï¸ drawing [45 min]",
    tasks: [
      { name: "Warm Ups", minutes: 5 },
      { name: "Caricature - Face 1", minutes: 2.5 },
      { name: "Caricature - Face 2", minutes: 2.5 },
      { name: "Character Poses Sketches", minutes: 10 },
      { name: "Face Study", minutes: 10 },
      { name: "Animation Practice", minutes: 15 },
    ]
  },
  drawing60: {
    title: "âœï¸ drawing [1 Hr]",
    tasks: [
      { name: "Warm Ups", minutes: 3 },
      { name: "1 Quick Caricature", minutes: 2 },
      { name: "Character Poses Sketches", minutes: 15 },
      { name: "Face Study", minutes: 15 },
      { name: "Animation Practice", minutes: 15 },
      { name: "Wind Down: Other Artist Style Study", minutes: 10 },
    ]
  },
};

let currentRoutineKey = null;
let currentRoutine = null;
let currentTaskIndex = 0;
let timeRemaining = 0;
let timerInterval = null;
let paused = false;
let lastBeepSecond = null;


/* ================= HELPERS ================= */

function formatTime(date) {
  return date.toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });
}

function getTotalMinutes(tasks) {
  return tasks.reduce((s, t) => s + t.minutes, 0);
}

/* ================= ROUTINE META ================= */

function populateRoutineMeta() {
  Object.keys(routines).forEach(key => {
    const r = routines[key];
    const total = getTotalMinutes(r.tasks);
    const done = new Date(Date.now() + total * 60000);
    document.getElementById(`${key}Meta`).innerText =
      `${r.tasks.length} tasks â€¢ ${total} min â€¢ Done by ${formatTime(done)}`;
  });
}

/* ================= SCHEDULE ================= */

function buildScheduleTable(startTime = new Date()) {
  const tbody = document.getElementById("scheduleTableBody");
  tbody.innerHTML = "";

  let t = new Date(startTime);

  currentRoutine.tasks.forEach((task, i) => {
    t = new Date(t.getTime() + task.minutes * 60000);
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${task.name}</td>
      <td>${task.minutes} min</td>
      <td>${formatTime(t)}</td>
    `;
    tbody.appendChild(row);
  });
}

function updateScheduleHighlight() {
  document.querySelectorAll("#scheduleTableBody tr").forEach((row, i) => {
    row.classList.remove("task-current", "task-complete");
    if (i < currentTaskIndex) row.classList.add("task-complete");
    if (i === currentTaskIndex) row.classList.add("task-current");
  });
}

/* ================= TIMER ================= */

function startRoutine(key, resume = false) {
  currentRoutineKey = key;
  currentRoutine = routines[key];

  document.getElementById("routineGrid").style.display = "none";
  document.getElementById("timerView").style.display = "block";
  document.getElementById("routineTitle").innerText = currentRoutine.title;
  document.getElementById("taskTotal").innerText = currentRoutine.tasks.length;

  buildScheduleTable();
  if (!resume) currentTaskIndex = 0;
  startTask();
}

function startTask() {
  const task = currentRoutine.tasks[currentTaskIndex];
  if (!paused) timeRemaining ||= task.minutes * 60;

  lastBeepSecond = null;

  document.getElementById("taskName").innerText = task.name;
  document.getElementById("taskIndex").innerText = currentTaskIndex + 1;

  updateScheduleHighlight();
  updateTimerDisplay();

  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (!paused) {
        timeRemaining--;

        // ğŸ”” 5-second countdown beeps
        if (
        timeRemaining <= 5 &&
        timeRemaining > 0 &&
        lastBeepSecond !== timeRemaining
        ) {
        document.getElementById("beep").play();
        lastBeepSecond = timeRemaining;
        }

        saveState();

        if (timeRemaining <= 0) {
        clearInterval(timerInterval);
        currentTaskIndex++;
        timeRemaining = 0;

        document.getElementById("beep").play();

        currentTaskIndex >= currentRoutine.tasks.length
            ? finishRoutine()
            : startTask();
        }

        updateTimerDisplay();
    }
  }, 1000);
}

function updateTimerDisplay() {
  document.getElementById("timeLeft").innerText =
    `${String(Math.floor(timeRemaining / 60)).padStart(2, "0")}:${String(timeRemaining % 60).padStart(2, "0")}`;
}

function pauseTimer() { paused = true; }

function resumeTimer() {
  paused = false;
  refreshScheduleFromNow();
}


/* ================= COMPLETE ================= */
  const images = [
      './assets/pic1.jpg',
      './assets/pic2.jpg',
      './assets/pic3.jpg',
      './assets/pic4.gif',
      './assets/pic5.jpg',
      './assets/pic6.jpg',
      './assets/pic7.jpg',
      './assets/pic8.jpg',
      './assets/pic9.jpg',
      './assets/pic10.jpg',
      './assets/pic11.jpg',
      './assets/pic12.jpg',
      './assets/pic13.jpg',
      './assets/pic14.jpg',
      './assets/pic15.jpg',
      './assets/pic16.jpg',
      './assets/pic17.jpg',
      './assets/pic18.jpg',
      './assets/pic19.jpg',
      './assets/pic20.jpg',
      './assets/pic21.jpg',
  ];

    const modal = new bootstrap.Modal(
     document.getElementById('imageModal'),
     { backdrop: 'static', keyboard: false }
  );

function showRandomImage() {
  const img = document.getElementById('modalImage');
  const random = images[Math.floor(Math.random() * images.length)];
  img.src = random;

  modal.show();

  // Auto close after 5 seconds
  setTimeout(() => {
    modal.hide();
    img.src = '';
  }, 5000);
}

function finishRoutine() {
  showRandomImage();

  document.getElementById("done").play();
  localStorage.removeItem("routineState");
  document.getElementById("taskName").innerText = "Routine Complete ğŸ‰";
  document.getElementById
}

/* ================= STORAGE ================= */

function saveState() {
  localStorage.setItem("routineState", JSON.stringify({
    key: currentRoutineKey,
    task: currentTaskIndex,
    time: timeRemaining
  }));
}

function loadState() {
  const state = JSON.parse(localStorage.getItem("routineState"));
  if (state) {
    currentTaskIndex = state.task;
    timeRemaining = state.time;
    startRoutine(state.key, true);
  }
}

/* ================= SKIP TASK ================= */

function skipTask() {
  clearInterval(timerInterval);
  document.getElementById("beep").play();

  currentTaskIndex++;
  timeRemaining = 0;
  paused = false;

  if (currentTaskIndex >= currentRoutine.tasks.length) {
    finishRoutine();
    return;
  }

  refreshScheduleFromNow();
  startTask();
}

function refreshScheduleFromNow() {
  const tbody = document.getElementById("scheduleTableBody");
  tbody.innerHTML = "";

  let now = new Date();

  currentRoutine.tasks.forEach((task, index) => {
    const row = document.createElement("tr");

    if (index < currentTaskIndex) {
      row.classList.add("task-complete");
      row.innerHTML = `
        <td>${index + 1}</td>
        <td>${task.name}</td>
        <td>${task.minutes} min</td>
        <td>âœ”</td>
      `;
    } else {
      now = new Date(now.getTime() + task.minutes * 60000);
      row.innerHTML = `
        <td>${index + 1}</td>
        <td>${task.name}</td>
        <td>${task.minutes} min</td>
        <td>${formatTime(now)}</td>
      `;
    }

    tbody.appendChild(row);
  });

  updateScheduleHighlight();
}

/* ================= RESET LOGO ================= */

function resetToHome() {
  if (currentRoutine) {
    const confirmReset = confirm("Are you sure you want to end this timer?");
    if (!confirmReset) return;
  }

  clearInterval(timerInterval);
  timerInterval = null;

  currentRoutineKey = null;
  currentRoutine = null;
  currentTaskIndex = 0;
  timeRemaining = 0;
  paused = false;

  localStorage.removeItem("routineState");

  document.getElementById("timerView").style.display = "none";
  document.getElementById("routineGrid").style.display = "block";

  populateRoutineMeta();
}


/* ================= THEME ================= */

function toggleTheme() {
  const html = document.documentElement;
  const next = html.dataset.bsTheme === "light" ? "dark" : "light";
  html.dataset.bsTheme = next;
  localStorage.setItem("theme", next);
}

function loadTheme() {
  document.documentElement.dataset.bsTheme =
    localStorage.getItem("theme") || "light";
}

/* ================= INIT ================= */

loadTheme();
populateRoutineMeta();
loadState();

</script>

</body>
</html>
